require "robut/storage/yaml_store"
require "rbots"

Robut::Connection.configure do |config|
  # https://confluence.atlassian.com/pages/viewpage.action?pageId=751436251
  #   Room history is automatically sent when joining a room unless your JID
  #   resource is “bot”.
  jid = ENV["RBOT_JID"]
  jid.concat("/bot") unless /\/bot$/ === jid
  config.jid = jid

  config.password = ENV["RBOT_PASSWORD"]
  config.nick = ENV["RBOT_NICK"]
  config.room = ENV["RBOT_ROOM"]

  config.mention_name = ENV["RBOT_AUX_MENTION"] if ENV["RBOT_AUX_MENTION"]

  Robut::Storage::YamlStore.file = ".robut"
  config.store = Robut::Storage::YamlStore

  config.logger = Logger.new(STDOUT)
end

require "robut/plugin/ping"
Robut::Plugin.plugins.concat([
  Robut::Plugin::Ping,
])
